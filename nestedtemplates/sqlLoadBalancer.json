{
   "$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion":"1.0.0.0",
   "parameters":{
      "location":{
         "type":"string"
      },
      "lbSettings":{
         "type":"object"
      },
      "sqlLBIPAddress":{
         "type":"string"
      },
      "derivedIds":{
         "type":"object"
      },
      "SQLAOProbe":{
         "type":"string"
      }
   },
  "resources": [
    {
      "apiVersion": "2015-06-15",
      "name": "[parameters('lbSettings').sqlLBName]",
      "type": "Microsoft.Network/loadBalancers",
      "location": "[parameters('location')]",
      "tags": {
        "Project": "BluePrint"
      },
      "properties": {
        "frontendIPConfigurations": [
          {
            "name": "[parameters('lbSettings').sqlLBFEName]",
            "properties": {
              "privateIPAllocationMethod": "Static",
              "privateIPAddress": "[parameters('sqlLBIPAddress')]",
              "subnet": {
                "id": "[parameters('derivedIds').sqlSubnet]"
              }
            }
          }
        ],
        "backendAddressPools": [
          {
            "name": "[parameters('lbSettings').sqlLBBEName]"
          }
        ],
        "loadBalancingRules": [
          {
            "name": "SQLAlwaysOnEndPointListener",
            "properties": {
              "backendAddressPool": {
                "id": "[parameters('derivedIds').sqlBEAddressPoolID]"
              },
              "frontendIPConfiguration": {
                "id": "[parameters('derivedIds').sqllbFEConfigID]"
              },
              "probe": {
                "id": "[parameters('derivedIds').sqllbProbeID]"
              },
              "protocol": "tcp",
              "frontendPort": 1433,
              "backendPort": 1433,
              "enableFloatingIP": true
            }
          }
        ],
        "probes": [
          {
            "name": "[parameters('SQLAOProbe')]",
            "properties": {
              "protocol": "tcp",
              "port": 59999,
              "intervalInSeconds": "5",
              "numberOfProbes": "2"
            }
          }
        ]
      }
    }
  ],
  "outputs": {}
}
